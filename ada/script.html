<!doctype html>
<html lang="tr">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Roblox Script Paylaşım</title>

    <!-- Prism.js (syntax highlighting) -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>

    <style>
        :root {
            --bg: #0f1724;
            --card: #0b1220;
            --muted: #9aa4b2;
            --accent: #4fd1c5;
            font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
            color: #e6eef6;
        }

        body {
            margin: 0;
            background: linear-gradient(180deg, #071020 0%, #071827 60%);
            min-height: 100vh;
        }

        header {
            padding: 18px 20px;
            display: flex;
            align-items: center;
            gap: 14px;
        }

        h1 {
            margin: 0;
            font-size: 18px;
            letter-spacing: 0.2px;
        }

        .container {
            max-width: 980px;
            margin: 18px auto;
            padding: 16px;
        }

        .toolbar {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 12px;
        }

        input[type="search"] {
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.06);
            background: transparent;
            color: var(--muted);
            min-width: 220px;
        }

        .btn {
            background: var(--accent);
            color: #082026;
            border: none;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600
        }

        .card {
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.02), rgba(255, 255, 255, 0.01));
            padding: 14px;
            border-radius: 12px;
            margin-bottom: 12px;
            border: 1px solid rgba(255, 255, 255, 0.03)
        }

        form {
            display: grid;
            grid-template-columns: 1fr 120px;
            gap: 10px;
            align-items: start
        }

        form .left {
            display: grid;
            gap: 8px;
        }

        label {
            font-size: 13px;
            color: var(--muted);
        }

        input[type="text"],
        select,
        textarea {
            width: 100%;
            padding: 8px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.06);
            background: transparent;
            color: var(--muted)
        }

        textarea {
            height: 140px;
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Courier New", monospace;
            resize: vertical;
        }

        .scripts-list {
            margin-top: 14px;
            display: grid;
            gap: 12px;
        }

        .meta {
            display: flex;
            gap: 8px;
            align-items: center;
            font-size: 13px;
            color: var(--muted)
        }

        .actions {
            margin-left: auto;
            display: flex;
            gap: 8px;
        }

        .small-btn {
            padding: 6px 8px;
            border-radius: 8px;
            border: none;
            background: rgba(255, 255, 255, 0.04);
            color: var(--muted);
            cursor: pointer
        }

        .chip {
            background: rgba(255, 255, 255, 0.03);
            padding: 6px 8px;
            border-radius: 999px;
            font-size: 12px
        }

        pre {
            margin: 8px 0;
            border-radius: 8px;
            overflow: auto;
            padding: 12px;
            background: rgba(0, 0, 0, 0.25)
        }

        .empty {
            color: var(--muted);
            padding: 18px;
            border-radius: 8px;
            text-align: center
        }

        footer {
            margin-top: 30px;
            color: var(--muted);
            text-align: center;
            font-size: 13px
        }

        @media (max-width:720px) {
            form {
                grid-template-columns: 1fr
            }

            .toolbar {
                justify-content: space-between
            }
        }
    </style>
</head>

<body>

    <header>
        <h1>Roblox Script Paylaşım</h1>
    </header>

    <div class="container">
        <div class="card">
            <form id="addForm">
                <div class="left">
                    <div>
                        <label for="title">Başlık</label>
                        <input id="title" required placeholder="Script başlığı (ör. AutoFarm v1)" />
                    </div>
                    <div>
                        <label for="category">Kategori</label>
                        <select id="category">
                            <option>Genel</option>
                            <option>UI</option>
                            <option>Automation</option>
                            <option>Tools</option>
                            <option>Örnek</option>
                        </select>
                    </div>
                    <div>
                        <label for="desc">Açıklama</label>
                        <input id="desc" placeholder="Kısa açıklama" />
                    </div>
                </div>
                <div>
                    <label for="code">Lua Script</label>
                    <textarea id="code" placeholder="Buraya Lua kodunu yapıştır... (örn. Roblox Lua)"></textarea>
                    <div style="display:flex;gap:6px;margin-top:8px;">
                        <button class="btn" type="submit">Ekle</button>
                        <button id="clearBtn" class="small-btn" type="button">Temizle</button>
                    </div>
                </div>
            </form>
        </div>

        <div class="toolbar">
            <input id="search" type="search" placeholder="Ara başlık, kategori veya açıklama..." />
            <div style="display:flex;gap:8px;align-items:center;margin-left:auto">
                <span class="chip" id="count">0 script</span>
                <button id="exportBtn" class="small-btn">JSON Dışa Aktar</button>
                <button id="importBtn" class="small-btn">JSON İçe Aktar</button>
                <input id="fileInput" type="file" accept="application/json" style="display:none" />
            </div>
        </div>

        <div id="list" class="scripts-list"></div>

        <div id="empty" class="empty" style="display:none">Henüz paylaşılmış bir script yok — ilk scriptini ekle!</div>

        <footer>
            <small>Bu örnek basittir. Gerçek site için kullanıcı yönetimi, moderasyon, rate limit ve içerik incelemesi
                ekle.</small>
        </footer>
    </div>

    <script>
        (function () {

            const LS_KEY = 'roblox_scripts_v1';
            let scripts = JSON.parse(localStorage.getItem(LS_KEY) || '[]');

            const $ = id => document.getElementById(id);
            const listEl = $('list');
            const emptyEl = $('empty');
            const countEl = $('count');
            const searchEl = $('search');
            const fileInput = $('fileInput');

            function save() {
                localStorage.setItem(LS_KEY, JSON.stringify(scripts));
            }

            function sanitizeText(str) {

                return String(str || '');
            }

            function render() {
                const q = searchEl.value.trim().toLowerCase();
                listEl.innerHTML = '';
                const filtered = scripts.filter(s => {
                    if (!q) return true;
                    return (s.title + ' ' + s.desc + ' ' + s.category).toLowerCase().includes(q);
                });

                countEl.textContent = filtered.length + ' script';

                if (filtered.length === 0) {
                    emptyEl.style.display = 'block';
                    return;
                } else emptyEl.style.display = 'none';

                filtered.slice().reverse().forEach((s, idx) => {
                    const card = document.createElement('div');
                    card.className = 'card';

                    const meta = document.createElement('div');
                    meta.className = 'meta';
                    meta.innerHTML = '<strong style="color:#fff">' + escapeHtml(s.title) + '</strong> <span class="chip">' + escapeHtml(s.category) + '</span> <span style="margin-left:8px;color:var(--muted)">' + escapeHtml(s.desc) + '</span>';

                    const actions = document.createElement('div');
                    actions.className = 'actions';
                    actions.style.marginLeft = 'auto';
                    actions.innerHTML = `
        <button class="small-btn" data-copy>Kopyala</button>
        <button class="small-btn" data-download>İndir</button>
        <button class="small-btn" data-delete style="color:#ff9da4">Sil</button>
      `;
                    meta.appendChild(actions);

                    const pre = document.createElement('pre');
                    pre.innerHTML = '<code class="language-lua">' + escapeHtml(s.code) + '</code>';

                    card.appendChild(meta);
                    card.appendChild(pre);
                    listEl.appendChild(card);


                    Prism.highlightElement(pre.querySelector('code'));


                    const copyBtn = card.querySelector('[data-copy]');
                    const downloadBtn = card.querySelector('[data-download]');
                    const deleteBtn = card.querySelector('[data-delete]');
                    copyBtn.addEventListener('click', async () => {
                        try {
                            await navigator.clipboard.writeText(s.code);
                            copyBtn.textContent = 'Kopyalandı ✓';
                            setTimeout(() => copyBtn.textContent = 'Kopyala', 1200);
                        } catch (e) {
                            alert('Kopyalama başarısız: ' + e);
                        }
                    });
                    downloadBtn.addEventListener('click', () => {
                        const blob = new Blob([s.code], { type: 'text/plain;charset=utf-8' });
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = (s.title.replace(/\s+/g, '_') || 'script') + '.lua';
                        document.body.appendChild(a);
                        a.click();
                        a.remove();
                        URL.revokeObjectURL(url);
                    });
                    deleteBtn.addEventListener('click', () => {
                        if (!confirm('Bu scripti silmek istiyor musun?')) return;
                        const realIndex = scripts.findIndex(x => x.id === s.id);
                        if (realIndex !== -1) {
                            scripts.splice(realIndex, 1);
                            save();
                            render();
                        }
                    });
                });
            }

            function escapeHtml(unsafe) {
                return sanitizeText(unsafe)
                    .replace(/&/g, "&amp;")
                    .replace(/</g, "&lt;")
                    .replace(/>/g, "&gt;");
            }

            $('addForm').addEventListener('submit', (ev) => {
                ev.preventDefault();
                const title = $('title').value.trim() || 'Untitled';
                const category = $('category').value;
                const desc = $('desc').value.trim();
                const code = $('code').value;
                if (!code.trim()) {
                    alert('Lütfen script kodunu gir.');
                    return;
                }
                const id = Date.now().toString(36) + Math.random().toString(36).slice(2, 7);
                scripts.push({ id, title, category, desc, code, created: Date.now() });
                save();
                render();
                $('title').value = '';
                $('desc').value = '';
                $('code').value = '';
            });

            $('clearBtn').addEventListener('click', () => {
                $('title').value = ''; $('desc').value = ''; $('code').value = '';
            });

            searchEl.addEventListener('input', render);

            $('exportBtn').addEventListener('click', () => {
                const data = JSON.stringify(scripts, null, 2);
                const blob = new Blob([data], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url; a.download = 'roblox_scripts.json';
                document.body.appendChild(a); a.click(); a.remove();
                URL.revokeObjectURL(url);
            });

            $('importBtn').addEventListener('click', () => fileInput.click());
            fileInput.addEventListener('change', (ev) => {
                const f = ev.target.files[0];
                if (!f) return;
                const reader = new FileReader();
                reader.onload = e => {
                    try {
                        const imported = JSON.parse(e.target.result);
                        if (!Array.isArray(imported)) throw new Error('Geçersiz format');

                        imported.forEach(it => {
                            if (!it.id) it.id = Date.now().toString(36) + Math.random().toString(36).slice(2, 7);
                            if (!scripts.find(s => s.id === it.id)) scripts.push(it);
                        });
                        save();
                        render();
                        alert('İçe aktarma tamamlandı.');
                    } catch (err) {
                        alert('İçe aktarma başarısız: ' + err.message);
                    }
                };
                reader.readAsText(f);
                fileInput.value = '';
            });

            render();

        })();
    </script>
</body>

</html>